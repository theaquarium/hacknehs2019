const map = L.map('map').setView([42.484390, -71.191670], 15);

const geoJSON = [
	{
		"type": "Feature",
		"properties": {
		  "type": "eee",
		  "risk": "high",
		  "popUpContent": "High EEE Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-71.70913696289061,
				42.01206037830712
			  ],
			  [
				-71.58279418945311,
				42.011550195928585
			  ],
			  [
				-71.58554077148436,
				42.05643057984999
			  ],
			  [
				-71.51412963867186,
				42.06458724463074
			  ],
			  [
				-71.29714965820311,
				42.22546663938053
			  ],
			  [
				-71.27517700195311,
				42.40013627993722
			  ],
			  [
				-71.39739990234374,
				42.48526384858916
			  ],
			  [
				-71.44546508789061,
				42.435620156499795
			  ],
			  [
				-71.5814208984375,
				42.437647200108685
			  ],
			  [
				-71.61575317382811,
				42.39405131362429
			  ],
			  [
				-71.69540405273436,
				42.40013627993722
			  ],
			  [
				-71.62124633789061,
				42.10076980332238
			  ],
			  [
				-71.74072265624999,
				42.0956749167229
			  ],
			  [
				-71.70913696289061,
				42.01206037830712
			  ]
			]
		  ]
		}
	  },
	  {
		"type": "Feature",
		"properties": {
		  "type": "eee",
		  "risk": "medium",
		  "popUpContent": "Medium EEE Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-71.71188354492188,
				42.0125705565935
			  ],
			  [
				-71.7462158203125,
				42.09618442380296
			  ],
			  [
				-71.619873046875,
				42.10026033308264
			  ],
			  [
				-71.63909912109375,
				42.18274112472145
			  ],
			  [
				-71.83273315429688,
				42.20817645934742
			  ],
			  [
				-72.0208740234375,
				42.19088154556975
			  ],
			  [
				-72.04421997070312,
				42.10943017110108
			  ],
			  [
				-72.05520629882812,
				42.02991418347818
			  ],
			  [
				-71.8011474609375,
				42.02379344357796
			  ],
			  [
				-71.79977416992188,
				42.00848901572399
			  ],
			  [
				-71.70913696289062,
				42.01665183556825
			  ],
			  [
				-71.71188354492188,
				42.0125705565935
			  ]
			]
		  ]
		}
	  },
	  {
		"type": "Feature",
		"properties": {
		  "type": "eee",
		  "risk": "medium",
		  "popUpContent": "Medium EEE Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-72.498779296875,
				42.039094188385945
			  ],
			  [
				-72.4658203125,
				42.145078043817534
			  ],
			  [
				-72.5921630859375,
				42.216313604344776
			  ],
			  [
				-72.7679443359375,
				42.204107493733176
			  ],
			  [
				-72.89703369140625,
				42.15322331239858
			  ],
			  [
				-72.850341796875,
				42.07580094787546
			  ],
			  [
				-72.83935546875,
				42.04113400940807
			  ],
			  [
				-72.498779296875,
				42.039094188385945
			  ]
			]
		  ]
		}
	  },
	  {
		"type": "Feature",
		"properties": {
		  "type": "eee",
		  "risk": "low",
		  "popUpContent": "Low EEE Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-72.93548583984375,
				42.037054301883806
			  ],
			  [
				-72.83935546875,
				42.032974332441405
			  ],
			  [
				-72.91351318359375,
				42.157295553651664
			  ],
			  [
				-72.7569580078125,
				42.20817645934742
			  ],
			  [
				-72.58941650390625,
				42.222415775126244
			  ],
			  [
				-72.46307373046874,
				42.13896840458089
			  ],
			  [
				-72.50152587890625,
				42.032974332441405
			  ],
			  [
				-72.0648193359375,
				42.03093424950211
			  ],
			  [
				-72.02362060546875,
				42.187829010590825
			  ],
			  [
				-71.81488037109375,
				42.21224516288584
			  ],
			  [
				-71.6473388671875,
				42.18986405028881
			  ],
			  [
				-71.69677734375,
				42.397093870535514
			  ],
			  [
				-71.6143798828125,
				42.397093870535514
			  ],
			  [
				-71.5814208984375,
				42.439674178149424
			  ],
			  [
				-71.45233154296875,
				42.4417010906216
			  ],
			  [
				-71.39465332031249,
				42.49032731830467
			  ],
			  [
				-71.38641357421875,
				42.56926437219384
			  ],
			  [
				-71.84234619140625,
				42.595554553719204
			  ],
			  [
				-72.32574462890625,
				42.61172761665585
			  ],
			  [
				-72.60040283203125,
				42.291532494305976
			  ],
			  [
				-72.8118896484375,
				42.29559582449642
			  ],
			  [
				-73.004150390625,
				42.1613675328748
			  ],
			  [
				-72.93548583984375,
				42.037054301883806
			  ]
			]
		  ]
		}
	  },
	  {
		"type": "Feature",
		"properties": {
		  "type": "eee",
		  "risk": "high",
		  "popUpContent": "High EEE Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-70.71624755859374,
				41.74262728637672
			  ],
			  [
				-70.80413818359375,
				41.87774145109676
			  ],
			  [
				-70.86593627929688,
				41.887965758804484
			  ],
			  [
				-70.91400146484375,
				41.89409955811395
			  ],
			  [
				-70.9716796875,
				41.81431422987254
			  ],
			  [
				-71.01287841796874,
				41.759019938155404
			  ],
			  [
				-70.8782958984375,
				41.68316883525891
			  ],
			  [
				-70.80413818359375,
				41.63186741069748
			  ],
			  [
				-70.76019287109375,
				41.65649719441145
			  ],
			  [
				-70.7464599609375,
				41.6872711837914
			  ],
			  [
				-70.71624755859374,
				41.74262728637672
			  ]
			]
		  ]
		}
	  },
	  {
		"type": "Feature",
		"properties": {
		  "type": "eee",
		  "risk": "medium",
		  "popUpContent": "Medium EEE Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-70.77392578125,
				41.84501267270689
			  ],
			  [
				-70.7135009765625,
				41.92271616673922
			  ],
			  [
				-70.8343505859375,
				41.97174336327968
			  ],
			  [
				-70.86181640625,
				41.896144026994854
			  ],
			  [
				-70.91949462890624,
				41.90023276842022
			  ],
			  [
				-71.01837158203125,
				41.928846628183166
			  ],
			  [
				-71.070556640625,
				41.86547012230937
			  ],
			  [
				-71.0540771484375,
				41.79384042311992
			  ],
			  [
				-70.99639892578125,
				41.790768787851285
			  ],
			  [
				-70.91812133789062,
				41.896144026994854
			  ],
			  [
				-70.79452514648436,
				41.880808915193874
			  ],
			  [
				-70.77392578125,
				41.84501267270689
			  ]
			]
		  ]
		}
	  },
	  {
		"type": "Feature",
		"properties": {
		  "type": "eee",
		  "risk": "low",
		  "popUpContent": "Low EEE Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-70.97579956054688,
				41.5651144735862
			  ],
			  [
				-70.97030639648438,
				41.56819689811343
			  ],
			  [
				-70.82473754882812,
				41.63494664852403
			  ],
			  [
				-71.01974487304688,
				41.759019938155404
			  ],
			  [
				-70.99365234375,
				41.78769700539063
			  ],
			  [
				-71.06781005859375,
				41.797935707842974
			  ],
			  [
				-71.07879638671875,
				41.86956082699455
			  ],
			  [
				-71.01837158203125,
				41.929868314485795
			  ],
			  [
				-70.8673095703125,
				41.89716623689334
			  ],
			  [
				-70.83847045898438,
				41.980931764968005
			  ],
			  [
				-70.70938110351562,
				41.9196507151163
			  ],
			  [
				-70.76705932617188,
				41.83785101947692
			  ],
			  [
				-70.7080078125,
				41.74979958661997
			  ],
			  [
				-70.62423706054688,
				41.74570122744876
			  ],
			  [
				-70.6146240234375,
				41.80919639152055
			  ],
			  [
				-70.61874389648438,
				41.94008427751427
			  ],
			  [
				-70.66955566406249,
				41.95744765908283
			  ],
			  [
				-70.70526123046875,
				41.99624282178583
			  ],
			  [
				-70.63934326171875,
				42.087012670088214
			  ],
			  [
				-70.69427490234375,
				42.132858175814626
			  ],
			  [
				-70.71762084960938,
				42.20614200929954
			  ],
			  [
				-70.83984375,
				42.25800001792787
			  ],
			  [
				-70.97442626953125,
				42.248851700720955
			  ],
			  [
				-71.10763549804688,
				42.26511445833756
			  ],
			  [
				-71.28753662109375,
				42.21936476344714
			  ],
			  [
				-71.50177001953125,
				42.06764572379527
			  ],
			  [
				-71.57867431640625,
				42.06356771883277
			  ],
			  [
				-71.57730102539062,
				42.011550195928585
			  ],
			  [
				-71.38229370117188,
				42.01359090088998
			  ],
			  [
				-71.37405395507812,
				41.896144026994854
			  ],
			  [
				-71.34246826171875,
				41.89818843043047
			  ],
			  [
				-71.32049560546875,
				41.78052894057897
			  ],
			  [
				-71.26556396484375,
				41.75799552006108
			  ],
			  [
				-71.19827270507812,
				41.67496335351134
			  ],
			  [
				-71.136474609375,
				41.65752323108278
			  ],
			  [
				-70.97579956054688,
				41.5651144735862
			  ]
			]
		  ]
		}
	  },
	  {
		"type": "Feature",
		"properties": {
		  "type": "wnv",
		  "risk": "low",
		  "popUpContent": "Low WNV Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-70.71487426757812,
				41.9829734519797
			  ],
			  [
				-70.80001831054688,
				42.037054301883806
			  ],
			  [
				-70.87692260742188,
				41.9921602333763
			  ],
			  [
				-70.86181640625,
				41.928846628183166
			  ],
			  [
				-70.82199096679688,
				41.852173524388824
			  ],
			  [
				-70.71624755859374,
				41.86240192202143
			  ],
			  [
				-70.71487426757812,
				41.9829734519797
			  ]
			]
		  ]
		}
	  },
	  {
		"type": "Feature",
		"properties": {
		  "type": "wnv",
		  "risk": "low",
		  "popUpContent": "Low WNV Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-71.07330322265625,
				42.33621470741859
			  ],
			  [
				-71.0430908203125,
				42.42142901536395
			  ],
			  [
				-71.1474609375,
				42.41737381352118
			  ],
			  [
				-71.3726806640625,
				42.35854391749705
			  ],
			  [
				-71.2353515625,
				42.256983603767466
			  ],
			  [
				-71.12274169921875,
				42.19393393313973
			  ],
			  [
				-71.07330322265625,
				42.33621470741859
			  ]
			]
		  ]
		}
	  },
	  {
		"type": "Feature",
		"properties": {
		  "type": "wnv",
		  "risk": "low",
		  "popUpContent": "Low WNV Risk"
		},
		"geometry": {
		  "type": "Polygon",
		  "coordinates": [
			[
			  [
				-71.76063537597656,
				42.31032319883329
			  ],
			  [
				-71.80526733398438,
				42.321493391673876
			  ],
			  [
				-71.88011169433594,
				42.26613074143641
			  ],
			  [
				-71.87667846679688,
				42.20868506162206
			  ],
			  [
				-71.78810119628906,
				42.19444265006986
			  ],
			  [
				-71.72698974609375,
				42.23716025326758
			  ],
			  [
				-71.76063537597656,
				42.31032319883329
			  ]
			]
		  ]
		}
	}
];

const baseLayer = L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=D8jbzWhuxqVcogN8aSZg', {
    attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">© MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>',
}).addTo(map);

fetch('/heatmapdata.json').then(res => {
	const json = res.json().then(data => {
		console.log(data);
		const heat = L.heatLayer(data, {minOpacity: 0.1, maxZoom: 12, radius: 75, max: 1, gradient: {0: '#ff00ff', 0.25: '#0000ff', 0.5: '#00ff00', 0.75: '#ffff00', 1: '#ff0000'}}).addTo(map);
	});
});

const legend = L.control({ position: "bottomright" });

legend.onAdd = function(map) {
  const div = L.DomUtil.create("div", "legend");
  div.innerHTML += "<h4>Mosquito Risk</h4>";
  div.innerHTML += '<i style="background: #ff00ff"></i><span>Minimal Risk</span><br>';
  div.innerHTML += '<i style="background: #0000ff"></i><span>Very Unlikely</span><br>';
  div.innerHTML += '<i style="background: #00ff00"></i><span>Unlikely</span><br>';
  div.innerHTML += '<i style="background: #ffff00"></i><span>Likely</span><br>';
  div.innerHTML += '<i style="background: #ff0000"></i><span>Very Likely</span><br>';
  div.innerHTML += "<h4>EEE Risk</h4>";
  div.innerHTML += '<i style="background: #00d1ff"></i><span>Low EEE Risk</span><br>';
  div.innerHTML += '<i style="background: #8069f9"></i><span>Medium EEE Risk</span><br>';
  div.innerHTML += '<i style="background: #ff00f3"></i><span>High EEE Risk</span><br>';
  div.innerHTML += "<h4>WNV Risk</h4>";
  div.innerHTML += '<i style="background: #ff9300"></i><span>Low WNV Risk</span><br>';
  div.innerHTML += '<i style="background: #7dca35"></i><span>Medium WNV Risk</span><br>';
  div.innerHTML += '<i style="background: #00ff68"></i><span>High WNV Risk</span><br>';

  return div;
};

legend.addTo(map);

function onEachFeature(feature, layer) {
	if (feature.properties && feature.properties.popUpContent) {
		layer.bindPopup(feature.properties.popUpContent);
	}
}

L.geoJSON(geoJSON, {
	onEachFeature: onEachFeature,
	style: function(feature) {
		let intensity;
		switch (feature.properties.risk) {
			case 'low': intensity = 0.25;
			case 'medium':   intensity = 0.5;
			case 'high':   intensity = 1;
		}

		switch (feature.properties.type) {
			case 'eee': 
				if (feature.properties.risk === "low") {
					return { "color": "#00d1ff" };
				} else if (feature.properties.risk === "medium") {
					return { "color": "#8069f9" };
				} else if (feature.properties.risk === "high") {
					return { "color": "#ff00f3" };
				}
				break;
			case 'wnv': 
				if (feature.properties.risk === "low") {
					return { "color": "#ff9300" };
				} else if (feature.properties.risk === "medium") {
					return { "color": "#7dca35" };
				} else if (feature.properties.risk === "high") {
					return { "color": "#00ff68" };
				}
				break;
		}
	}
}).addTo(map);


var marker;
function yeet() {
    map.once('click', function (e) {
        if (marker != undefined) {
            map.removeLayer(marker);
        };

        //Add a marker to show where you clicked.
        marker = new L.marker(e.latlng, {
            draggable: true,
            autoPan: true
        }).addTo(map);
    });
};
console.log("you gone done good");

function submit() {
    fetch("/reportdata",
        {
            headers: {
                'Content-Type': 'application/json'
            },
            method: "POST",
            body: JSON.stringify([marker.getLatLng().lat, marker.getLatLng().lng])
        })
		.then(function (res) {
			setTimeout(() => {
				location.reload();
			}, 2500);
		})
        .catch(function (res) { console.log(res) });
}
